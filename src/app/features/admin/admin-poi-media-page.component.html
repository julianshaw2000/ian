<div class="vh-admin-shell">
  <mat-toolbar color="primary" class="vh-admin-toolbar">
    <span class="vh-admin-title">
      <mat-icon>collections</mat-icon>
      <span>Media for stop</span>
    </span>

    <span class="vh-admin-toolbar-spacer"></span>

    <span *ngIf="auth.userEmail() as email" class="vh-admin-user">
      {{ email }}
    </span>

    <a mat-button [routerLink]="['/admin/tours']">
      <mat-icon>map</mat-icon>
      <span>Tours</span>
    </a>

    <button mat-button type="button" (click)="logout()">
      <mat-icon>logout</mat-icon>
      <span>Logout</span>
    </button>

    <a mat-button routerLink="/">
      <mat-icon>home</mat-icon>
      <span>Back to app</span>
    </a>
  </mat-toolbar>

  <main class="vh-admin-main">
    <section class="vh-admin-layout">
      <mat-card class="vh-admin-list">
        <mat-card-header>
          <mat-card-title>Media items</mat-card-title>
          <mat-card-subtitle>Images, audio and links for this stop</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <button mat-stroked-button color="primary" (click)="newMedia()">
            <mat-icon>add_photo_alternate</mat-icon>
            <span>New media</span>
          </button>

          <ul class="vh-admin-media">
            <li *ngFor="let m of media()">
              <button
                mat-button
                type="button"
                (click)="editMedia(m)"
                [class.vh-admin-media-selected]="m.id === selectedId()"
              >
                <span class="vh-admin-media-title">
                  {{ m.media_type }} – {{ m.label || m.url }}
                </span>
                <span class="vh-admin-media-meta">
                  Order {{ m.sort_order ?? 0 }} · {{ m.url }}
                </span>
              </button>

              <button
                mat-icon-button
                color="warn"
                type="button"
                (click)="delete(m)"
                aria-label="Delete media"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </li>
          </ul>
        </mat-card-content>
      </mat-card>

      <mat-card class="vh-admin-form">
        <mat-card-header>
          <mat-card-title>{{ isEditingExisting() ? 'Edit media' : 'Create media' }}</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <form [formGroup]="form" (ngSubmit)="save()">
            <div class="vh-admin-form-grid">
              <mat-form-field appearance="outline">
                <mat-label>Media ID</mat-label>
                <input matInput formControlName="id" />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Type</mat-label>
                <mat-select formControlName="media_type">
                  <mat-option value="image">Image</mat-option>
                  <mat-option value="audio">Audio</mat-option>
                  <mat-option value="music">Music</mat-option>
                  <mat-option value="video">Video</mat-option>
                  <mat-option value="external_link">External link</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="vh-admin-form-full">
                <mat-label>URL</mat-label>
                <input matInput formControlName="url" />
              </mat-form-field>

              <mat-form-field appearance="outline" class="vh-admin-form-full">
                <mat-label>Label</mat-label>
                <input matInput formControlName="label" />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Sort order</mat-label>
                <input matInput type="number" formControlName="sort_order" />
              </mat-form-field>

              <div class="vh-admin-form-full">
                <label class="vh-admin-upload-label">
                  Upload file (image/audio)
                  <input type="file" (change)="uploadFile($event)" />
                </label>
              </div>
            </div>

            <button
              mat-raised-button
              color="primary"
              type="submit"
              class="vh-admin-save"
              [disabled]="saving()"
            >
              <mat-icon>save</mat-icon>
              <span>Save</span>
            </button>
          </form>

          <p *ngIf="errorMessage()" class="vh-admin-error">
            {{ errorMessage() }}
          </p>
        </mat-card-content>
      </mat-card>
    </section>
  </main>
</div>
